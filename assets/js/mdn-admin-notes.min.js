function check_version(e){e.ajax({url:ajaxurl,method:"POST",data:{action:"update_version"}})}function mdn_save_handler(e,t){const n=t;e("#"+t.titleId).html(e("#"+t.titleInput).val()),e("#"+t.titleId).addClass("hndle ui-sortable-handle"),e.ajax({url:ajaxurl,method:"POST",data:{action:"mdn_save_note",data:n},success:n=>{"success"===n.status?(e("#"+t.contentId).html(n.content),mdn_revoke_footer_actions(e),mdn_revoke_edit_listeners(e),mdn_revoke_delete_listeners(e),mdn_handle_checkboxes(e)):"large_content"===n.status&&(alert("Content exceeded ... Max. 2500 characters"),e("#"+t.textContentId).prop("disabled",!1),e("#"+t.textContentId).trigger("focus"))}})}function mdn_init_edit_listeners(e){e('button[data-name="mdn-note-edit"]').each((t,n)=>{e(n).on("click",()=>{e(n).prop("disabled",!0);const t=e(n).data("note-id");mdn_handle_update_state(e,t)})})}function mdn_revoke_edit_listeners(e){e('button[data-name="mdn-note-edit"]').each((t,n)=>{e(n).off("click")}),e('button[data-name="mdn-note-edit"]').each((t,n)=>{e(n).on("click",()=>{e(n).prop("disabled",!0);const t=e(n).data("note-id");mdn_handle_update_state(e,t)})})}function mdn_revoke_footer_actions(e){e('div[id^="mdn_note_"]').each((t,n)=>{e(n).off("mouseenter")}),e('div[id^="mdn_note_"]').each((t,n)=>{e(n).on("mouseenter",()=>{const t=e(n).find(".mdn-footer-actions")[0];e(t).addClass("mdn-fadein"),e(n).on("mouseleave",()=>{e(t).removeClass("mdn-fadein")})})})}function mdn_update_handler(e,t){e.ajax({url:ajaxurl,method:"POST",data:{action:"mdn_update_note",id:t.noteId,title:e(t.input).val(),content:e(t.textArea).val()},success:n=>{t.formBody.html(""),t.formBody.html(n.content),e(t.input).hide(),e(t.h2).text(e(t.input).val()),e(t.input).remove(),e(t.controlsDiv).remove(),e(t.h2).removeClass("mdn-header-edit-state"),e(t.h2).addClass("hndle ui-sortable-handle"),e(t.h2).next().show(),mdn_revoke_edit_listeners(e),mdn_revoke_delete_listeners(e),mdn_handle_checkboxes(e)}})}function mdn_handle_update_state(e,t){const n=e("#mdn_note_"+t);e(n).find("[data-name=mdn-note-delete]:first").prop("disabled",!0);const d=e(n).find("h2:first"),o=e(n).find("div.inside:first");e(d).removeClass("hndle ui-sortable-handle"),e(d).addClass("mdn-header-edit-state");const a=e(d).text(),l=document.createElement("input");l.type="text",l.value=a,e.ajax({url:ajaxurl,method:"POST",data:{action:"mdn_update_form_content",id:t},success:s=>{e(d).html(""),e(o).html("");const i=e(n).find("div.postbox-header:first"),r=document.createElement("div"),c=document.createElement("button"),m=document.createElement("button");if(e(c).addClass("button button-secondary mdn-cancle-button"),e(m).addClass("button button-primary mdn-save-button"),e(m).prop("title","[Ctrl + Enter]"),e(c).text(s.controlLocale.cancel),e(m).text(s.controlLocale.save),e(r).append(c),e(r).append(m),e(i).append(r),"success"===s.status){e(d).append(l),e(d).next().hide(),o.append(s.html);const n=e("#"+s.textContentId),i={noteId:t,h2:d,input:l,textArea:n,formBody:o,controlsDiv:r};e(n).on("keydown",t=>{if(t.ctrlKey&&13==t.keyCode&&(e(n).prop("disabled",!0),e(l).prop("disabled",!0),e(n).trigger("blur"),mdn_update_handler(e,i)),9==t.keyCode||9==t.which){let e=document.getElementById(s.textContentId);t.preventDefault(),e.setRangeText("\t",e.selectionStart,e.selectionStart,"end")}}),e(l).on("keydown",t=>{t.ctrlKey&&13==t.keyCode&&(e(l).prop("disabled",!0),e(l).trigger("blur"),e(n).prop("disabled",!0),mdn_update_handler(e,i))}),e(m).on("click",()=>{e(l).prop("disabled",!0),e(n).prop("disabled",!0),e(c).prop("disabled",!0),mdn_update_handler(e,i)}),e(c).on("click",()=>{e(r).remove(),e(d).html(""),e(d).text(a),e(d).removeClass("mdn-header-edit-state"),e(d).addClass("hndle ui-sortable-handle"),e(d).next().show(),e(o).html(s.cancelContent),mdn_revoke_edit_listeners(e),mdn_revoke_delete_listeners(e),mdn_handle_checkboxes(e)}),e(n).on("keyup",()=>{e("#"+s.textCountId).text(e("#"+s.textContentId).val().length)})}}}),e(l).on("click",e=>{e.stopPropagation()})}function mdn_revoke_delete_listeners(e){e('button[data-name="mdn-note-delete"]').each((t,n)=>{e(n).off("click")}),mdn_init_delete_listeners(e)}function mdn_init_delete_listeners(e){e('button[data-name="mdn-note-delete"]').each((t,n)=>{e(n).on("click",()=>{e(n).prop("disabled",!0);const t=e(n).data("note-id");e("#mdn_note_"+t).find("h2:first").text();1==confirm(e(n).data("confirm-message"))?e.ajax({url:ajaxurl,method:"POST",data:{action:"mdn_delete_note",noteId:t},success:t=>{"success"===t.status?e("#mdn_note_"+e(n).data("note-id")).remove():e(n).prop("disabled",!1)}}):e(n).prop("disabled",!1)})})}function mdn_handle_checkboxes(e){e(".mdn-markdown-content ul").each((t,n)=>{e(n).find("li").children().each((e,t)=>{"INPUT"!==t.nodeName||(t.disabled=!1)})})}jQuery(document).ready(e=>{check_version(e),e('div[id^="mdn_note_"]').each((t,n)=>{e(n).on("mouseenter",()=>{const t=e(n).find(".mdn-footer-actions")[0];e(t).addClass("mdn-fadein"),e(n).on("mouseleave",()=>{e(t).removeClass("mdn-fadein")})})}),mdn_handle_checkboxes(e),e(document.body).on("click",".mdn-notes-add-note, #mdn-notes-add a",t=>{e.ajax({url:ajaxurl,method:"POST",data:{action:"mdn_add_new_note"},success:t=>{e("#normal-sortables").prepend(t.note),e("#"+t.textContentId).trigger("focus"),e("#"+t.textContentId).on("keydown",n=>{if(n.ctrlKey&&13==n.keyCode&&(e("#"+t.cancelBtn).remove(),e("#"+t.saveBtn).remove(),e("#"+t.textContentId).trigger("blur"),e("#"+t.textContentId).prop("disabled",!0),t.titleContent=e("#"+t.titleInput).val(),t.textContent=e("#"+t.textContentId).val(),delete t.note,mdn_save_handler(e,t)),9==n.keyCode||9==n.which){let e=document.getElementById(t.textContentId);n.preventDefault(),e.setRangeText("\t",e.selectionStart,e.selectionStart,"end")}}),e("#"+t.saveBtn).on("click",()=>{e("#"+t.cancelBtn).remove(),e("#"+t.saveBtn).remove(),e("#"+t.titleInput).prop("disabled",!0),e("#"+t.textContentId).prop("disabled",!0),t.titleContent=e("#"+t.titleInput).val(),t.textContent=e("#"+t.textContentId).val(),delete t.note,mdn_save_handler(e,t)}),e("#"+t.titleInput).on("keydown",n=>{n.ctrlKey&&13==n.keyCode&&(e("#"+t.cancelBtn).remove(),e("#"+t.saveBtn).remove(),e("#"+t.titleInput).trigger("blur"),e("#"+t.titleInput).prop("disabled",!0),e("#"+t.textContentId).prop("disabled",!0),t.titleContent=e("#"+t.titleInput).val(),t.textContent=e("#"+t.textContentId).val(),delete t.note,mdn_save_handler(e,t))}),e("#"+t.textContentId).on("keyup",()=>{e("#"+t.textCountId).text(e("#"+t.textContentId).val().length)}),e("#"+t.cancelBtn).on("click",()=>{e("#"+t.widgetId).remove()})}}),t.preventDefault()}),mdn_init_edit_listeners(e),mdn_init_delete_listeners(e)});