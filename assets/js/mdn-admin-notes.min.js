function check_version(e){e.ajax({url:ajaxurl,method:"POST",data:{action:"update_version"}})}function mdn_save_handler(e,t){const n=t;e.ajax({url:ajaxurl,method:"POST",data:{action:"mdn_save_note",data:n},success:n=>{"success"===n.status?(e("#"+t.contentId).html(n.content),mdn_revoke_edit_listeners(e),mdn_revoke_delete_listeners(e),mdn_handle_checkboxes(e)):"large_content"===n.status&&(alert("Content exceeded ... Max. 2500 characters"),e("#"+t.textContentId).prop("disabled",!1),e("#"+t.textContentId).trigger("focus"))}})}function mdn_init_edit_listeners(e){e('button[data-name="mdn-note-edit"]').each((t,n)=>{e(n).on("click",()=>{e(n).prop("disabled",!0);const t=e(n).data("note-id");mdn_handle_update_state(e,t)})}),e('div[id^="mdn_note_"]').each((t,n)=>{e(n).on("dblclick",()=>{e(n).off("dblclick");const t=n.id.split("_"),d=t[t.length-1];mdn_handle_update_state(e,d)})})}function mdn_revoke_edit_listeners(e){e('button[data-name="mdn-note-edit"]').each((t,n)=>{e(n).off("click")}),e('div[id^="mdn_note_"]').each((t,n)=>{e(n).off("dblclick")}),e('button[data-name="mdn-note-edit"]').each((t,n)=>{e(n).on("click",()=>{e("#mdn_note_"+e(n).data("note-id")).off("dblclick"),e("#mdn_note_content_"+e(n).data("note-id")).off("dblclick"),e("#mdn_note_update_text_content_"+e(n).data("note-id")).off("dblclick"),e(n).prop("disabled",!0);const t=e(n).data("note-id");mdn_handle_update_state(e,t)})}),e('div[id^="mdn_note_"]').each((t,n)=>{e(n).on("dblclick",()=>{e(n).off("dblclick");const t=n.id.split("_"),d=t[t.length-1];mdn_handle_update_state(e,d)})})}function mdn_handle_update_state(e,t){const n=e("#mdn_note_"+t);e(n).off("dblclick");const d=e(n).find("h2:first"),a=e(n).find("div.inside:first");e(d).text();e(d).removeClass("hndle ui-sortable-handle"),e(d).addClass("mdn-header-edit-state");const o=e(d).text(),l=document.createElement("input");l.type="text",l.value=o,e.ajax({url:ajaxurl,method:"POST",data:{action:"mdn_update_form_content",id:t},success:n=>{if(e(d).html(""),e(a).html(""),"success"===n.status){e(d).append(l),e(d).next().hide(),a.append(n.html);const o=e("#"+n.textContentId);e(o).off("dblclick"),e(o).on("keydown",i=>{if(i.ctrlKey&&13==i.keyCode&&(e("#"+n.textContentId).prop("disabled",!0),e("#"+n.textContentId).trigger("blur"),e.ajax({url:ajaxurl,method:"POST",data:{action:"mdn_update_note",id:t,title:e(l).val(),content:e(o).val()},success:t=>{a.html(""),a.html(t.content),e(l).hide(),e(d).text(e(l).val()),e(l).remove(),e(d).addClass("hndle ui-sortable-handle"),e(d).next().show(),mdn_revoke_edit_listeners(e),mdn_revoke_delete_listeners(e),mdn_handle_checkboxes(e)}})),9==i.keyCode||9==i.which){let e=document.getElementById(n.textContentId);i.preventDefault(),e.setRangeText("\t",e.selectionStart,e.selectionStart,"end")}}),e(l).on("keydown",n=>{n.ctrlKey&&13==n.keyCode&&(e(l).prop("disabled",!0),e(l).trigger("blur"),e(o).prop("disabled",!0),e.ajax({url:ajaxurl,method:"POST",data:{action:"mdn_update_note",id:t,title:e(l).val(),content:e(o).val()},success:t=>{a.html(""),a.html(t.content),e(l).hide(),e(d).text(e(l).val()),e(l).remove(),e(d).addClass("hndle ui-sortable-handle"),e(d).next().show(),mdn_revoke_edit_listeners(e),mdn_revoke_delete_listeners(e)}}))}),e(o).on("keyup",()=>{e("#"+n.textCountId).text(e("#"+n.textContentId).val().length)})}}}),e(l).on("click",e=>{e.stopPropagation()}),e(l).on("dblclick",e=>{e.stopPropagation()})}function mdn_revoke_delete_listeners(e){e('button[data-name="mdn-note-delete"]').each((t,n)=>{e(n).off("click")}),mdn_init_delete_listeners(e)}function mdn_init_delete_listeners(e){e('button[data-name="mdn-note-delete"]').each((t,n)=>{e(n).on("click",()=>{e(n).prop("disabled",!0);const t=e(n).data("note-id"),d=e("#mdn_note_"+t).find("h2:first").text();1==confirm('Sure to delete "'+d+'"?')?e.ajax({url:ajaxurl,method:"POST",data:{action:"mdn_delete_note",noteId:t},success:t=>{"success"===t.status?e("#mdn_note_"+e(n).data("note-id")).remove():e(n).prop("disabled",!1)}}):e(n).prop("disabled",!1)})})}function mdn_handle_checkboxes(e){e(".mdn-markdown-content ul").each((t,n)=>{e(n).find("li").children().each((e,t)=>{"INPUT"!==t.nodeName||(t.disabled=!1)})})}jQuery(document).ready(e=>{check_version(e),mdn_handle_checkboxes(e),e(document.body).on("click",".mdn-notes-add-note, #mdn-notes-add a",t=>{e.ajax({url:ajaxurl,method:"POST",data:{action:"mdn_add_new_note"},success:t=>{e("#normal-sortables").prepend(t.note),e("#"+t.textContentId).trigger("focus"),e("#"+t.textContentId).on("keydown",n=>{if(n.ctrlKey&&13==n.keyCode&&(e("#"+t.textContentId).prop("disabled",!0),e("#"+t.textContentId).trigger("blur"),t.textContent=e("#"+t.textContentId).val(),delete t.note,mdn_save_handler(e,t)),9==n.keyCode||9==n.which){let e=document.getElementById(t.textContentId);n.preventDefault(),e.setRangeText("\t",e.selectionStart,e.selectionStart,"end")}}),e("#"+t.textContentId).on("keyup",()=>{e("#"+t.textCountId).text(e("#"+t.textContentId).val().length)})}}),t.preventDefault()}),mdn_init_edit_listeners(e),mdn_init_delete_listeners(e)});